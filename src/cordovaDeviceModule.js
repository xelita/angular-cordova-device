/**
 * Angular Module relying on Apache Cordova Network Information Plugin (cordova plugin add org.apache.cordova.device).
 * For more information: https://github.com/apache/cordova-plugin-device
 */
var cordovaDeviceModule = angular.module('cordovaDeviceModule', []);

// Constants

/**
 * Constants service used in the whole module.
 */
cordovaDeviceModule.constant('cordovaDeviceConstants', {
    apiVersion: '1.0.0',
    cordovaVersion: '>=3.4.0'
});

// Services

/**
 * Main service relying on Apache Cordova Device Plugin.
 */
cordovaDeviceModule.factory('cordovaDeviceService', ['$log', 'cordovaDeviceConstants', function ($log, cordovaDeviceConstants) {
    return {
        /**
         * Return the current API version.
         */
        apiVersion: function () {
            $log.debug('cordovaDeviceService.apiVersion.');
            return cordovaDeviceConstants.apiVersion;
        },

        /**
         * Return the cordova API version.
         */
        cordovaVersion: function () {
            $log.debug('cordovaDeviceConstants.cordovaVersion.');
            return cordovaDeviceConstants.cordovaVersion;
        },

        /**
         * Get the version of Cordova running on the device.
         * For more information: https://github.com/apache/cordova-plugin-device/blob/master/doc/index.md#devicecordova
         */
        cordova: function () {
            $log.debug('cordovaDeviceService.cordova.');
            return this.getDeviceValue('cordova');
        },

        /**
         * Get the device's operating system name.
         * For more information: https://github.com/apache/cordova-plugin-device/blob/master/doc/index.md#deviceplatform
         */
        platform: function () {
            $log.debug('cordovaDeviceService.platform.');
            return this.getDeviceValue('platform');
        },

        /**
         * Get the device's Universally Unique Identifier (UUID).
         * For more information: https://github.com/apache/cordova-plugin-device/blob/master/doc/index.md#deviceuuid
         */
        uuid: function () {
            $log.debug('cordovaDeviceService.uuid.');
            return this.getDeviceValue('uuid');
        },

        /**
         * Get the operating system version.
         * For more information: https://github.com/apache/cordova-plugin-device/blob/master/doc/index.md#deviceversion
         */
        version: function () {
            $log.debug('cordovaDeviceService.version.');
            return this.getDeviceValue('version');
        },

        /**
         * The device.model returns the name of the device's model or product.
         * For more information: https://github.com/apache/cordova-plugin-device/blob/master/doc/index.md#devicemodel
         */
        model: function () {
            $log.debug('cordovaDeviceService.model.');
            return this.getDeviceValue('model');
        },

        /**
         * Return the device parameter value.
         * @param name the parameter name.
         */
        getDeviceValue: function (name) {
            $log.debug('cordovaDeviceService.value.');
            if (!window.device) {
                $log.warn('Device API is not available.');
                return null;
            }
            return window.device[name];
        }
    };
}]);


// Controllers

/**
 * Convenience controller that registers service in its scope.
 */
cordovaDeviceModule.controller('CordovaDeviceCtrl', ['$scope', 'cordovaDeviceService' , function ($scope, cordovaDeviceService) {

    // Export the cordovaDeviceService in the controller scope in order to make it accessible directly
    $scope.deviceService = cordovaDeviceService;
}]);